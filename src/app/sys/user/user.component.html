<div nz-row [nzGutter]="20">
  <div nz-col [nzSm]="6">
    <nz-card [nzTitle]="cardTitle" class="main-content-panel-height" [nzLoading]="!subSystem">
      <ng-template #cardTitle>
        <app-sub-system-chooser (changeSubSystemEvent)="orgChangeSubSystemEvent($event)"></app-sub-system-chooser>
      </ng-template>
      <app-org-chooser *ngIf="subSystem" (selectedEvent)="orgChangeEvent($event)"
                       [loadOrgData]="subSystem.id"></app-org-chooser>
    </nz-card>
  </div>
  <div nz-col [nzSm]="18">
    <nz-card nzTitle="用户列表" [nzExtra]="extraTemplate" class="main-content-panel-height">
      <nz-table #nzTable
                nzShowSizeChanger
                [nzFrontPagination]="false"
                [nzData]="dataSet"
                [nzLoading]="loading"
                [nzTotal]="total"
                [(nzPageIndex)]="pageIndex"
                [(nzPageSize)]="pageSize"
                (nzPageIndexChange)="loadUserTable()"
                (nzPageSizeChange)="loadUserTable(true)">
        <thead nz-thead (nzSortChange)="sort($event)" nzSingleSort>
        <tr>
          <th nz-th><span>序号</span></th>
          <th nz-th><span>登录名</span></th>
          <th nz-th><span>组织</span></th>
          <th nz-th><span>角色</span></th>
          <th nz-th><span>手机</span></th>
          <th nz-th><span>邮箱</span></th>
          <th nz-th>操作</th>
        </tr>
        </thead>
        <tbody nz-tbody>
        <tr nz-tbody-tr *ngFor="let data of nzTable.data; let i=index;">
          <td nz-td>{{ startRow+i }}</td>
          <td nz-td>{{data.username}}</td>
          <td nz-td>{{data.org?data.org.name:'/'}}</td>
          <td nz-td>
            <div *ngIf="data.roles && data.roles.length > 0;else no_content">
              <nz-tag [nzColor]="'orange'" *ngFor="let role of data.roles">{{role.name}}</nz-tag>
            </div>
            <ng-template #no_content>/</ng-template>
          </td>
          <td nz-td>{{data.phone}}</td>
          <td nz-td>{{data.email}}</td>
          <td>
            <a (click)="modifyUser(data)">编辑</a>
            <nz-divider nzType="vertical"></nz-divider>
            <nz-popconfirm [nzTitle]="'确定删除['+data.username+']用户吗?'" (nzOnConfirm)="deleteUser(data.id)">
              <a nz-popconfirm>删除</a>
            </nz-popconfirm>
            <nz-divider nzType="vertical"></nz-divider>
            <nz-popconfirm [nzTitle]="'确定重置用户['+data.username+']的密码吗?'" (nzOnConfirm)="resetPassword(data.id)">
              <a nz-popconfirm>重置密码</a>
            </nz-popconfirm>
          </td>
        </tr>
        </tbody>
      </nz-table>
    </nz-card>
    <ng-template #extraTemplate>
      <button nz-button nzSize="small" (click)="addUser()" nzType="primary" [disabled]="!subSystem">
        <i nz-icon type="plus-circle" theme="outline"></i>
        添加
      </button>
    </ng-template>
  </div>
</div>
